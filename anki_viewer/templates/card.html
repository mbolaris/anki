{% macro render_card(card, deck, card_number=None) %}
  {% set is_image = card.card_type == "image" %}
  {% set display_number = card_number if card_number is not none else card.card_id %}
  <article
    class="card card--{{ card.card_type }}{% if is_image %} card--image{% endif %}"
    data-card-id="{{ card.card_id }}"
    data-card-type="{{ card.card_type }}"
    data-card-position="{{ display_number }}"
    {% if card.card_type == "cloze" %}
      data-card-endpoint="{{ url_for('card_data', deck_id=deck.deck_id, card_id=card.card_id) }}"
    {% endif %}
    {% if is_image %}data-has-images="true"{% endif %}
  >
    <header class="card-header">
      <div class="card-header__primary">
        <span class="card-chip card-chip--primary">Card {{ display_number }}</span>
        <span class="card-chip">Template {{ card.template_ordinal + 1 }}</span>
      </div>
      <div class="card-header__meta">
        <span class="card-meta-item">Note {{ card.note_id }}</span>
        <span class="card-meta-item">ID {{ card.card_id }}</span>
        <span class="card-meta-item card-meta-item--type">{{ card.card_type|title }}</span>
      </div>
    </header>
    <div class="card-body">
      <div class="card-inner">
        <div class="card-face question" aria-labelledby="card-question-heading-{{ card.card_id }}">
          <h4 id="card-question-heading-{{ card.card_id }}" class="sr-only">Question</h4>
          {% if card.card_type == "cloze" %}
            <p class="card-instruction cloze-instructions">
              Pause for a beat and retrieve the hidden text before you reveal the answer.
            </p>
          {% elif is_image %}
            <p class="card-instruction image-instructions">
              Study the image and describe the key idea in your own words before flipping the card.
            </p>
          {% else %}
            <p class="card-instruction retrieval-instructions">
              Try to answer the prompt out loud before revealing what's on the back.
            </p>
          {% endif %}
          <div class="content{% if card.question_revealed %} has-revealed{% endif %}">
            <div class="question-front" aria-hidden="false">{{ card.question | safe }}</div>
            {% if card.question_revealed %}
              <div class="question-revealed" aria-hidden="true">{{ card.question_revealed | safe }}</div>
            {% endif %}
          </div>
        </div>
        <div class="card-face answer" aria-labelledby="card-answer-heading-{{ card.card_id }}">
          <h4 id="card-answer-heading-{{ card.card_id }}" class="sr-only">Answer</h4>
          <p class="card-instruction answer-instructions">
            Did your response match? Summarize why this answer works to lock it in before you move on.
          </p>
          <div class="content">{{ card.answer | safe }}</div>
        </div>
      </div>
      {% if card.extra_fields %}
        <details class="extra-fields">
          <summary>Additional fields</summary>
          <dl>
            {% for value in card.extra_fields %}
              <dt>Additional field</dt>
              <dd>{{ value | safe }}</dd>
            {% endfor %}
          </dl>
        </details>
      {% endif %}
    </div>
  </article>
{% endmacro %}
